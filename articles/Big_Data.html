<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>SpaMTP: Handling Big Datasets • SpaMTP</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="SpaMTP: Handling Big Datasets">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpaMTP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SpaMTP.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/Mouse_Urinary_Bladder.html">Spatial Metabolomics Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Multi-Omic_Mouse_Brain.html">Spatial Multi-Omics Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/SpaMTP_Additional_Features.html">Additional SpaMTP Features</a></li>
    <li><a class="dropdown-item" href="../articles/Single_Cell_MultiOmics.html">Simulated Single Cell Multi-Omics Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/Big_Data.html">Handling Big Datasets</a></li>
    <li><a class="dropdown-item" href="../articles/Annotation_Refinement.html">Refinning Metabolite Annotations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Updates</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GenomicsMachineLearning/SpaMTP" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="Big_Data_files/kePrint-0.0.1/kePrint.js"></script><link href="Big_Data_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>SpaMTP: Handling Big Datasets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/genomicsmachinelearning/SpaMTP/blob/HEAD/vignettes/Big_Data.Rmd" class="external-link"><code>vignettes/Big_Data.Rmd</code></a></small>
      <div class="d-none name"><code>Big_Data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="handling-large-sm-datasets">Handling Large SM Datasets<a class="anchor" aria-label="anchor" href="#handling-large-sm-datasets"></a>
</h2>
<p>SpaMTP is suitable for datasets of all sizes. However, extra large
datasets may need special handling to speed up the analysis process. To
demonstrate some helpful functions for processing large datasets we will
use a public mouse liver dataset with spotted chemicals standards
published <a href="https://doi.org/10.1101/2024.10.14.618269" class="external-link">here</a>.</p>
<p>Author: Andrew Causer</p>
<p><br></p>
<div class="section level3">
<h3 id="import-r-libraries-and-load-data">Import <em>R</em> Libraries and Load Data<a class="anchor" aria-label="anchor" href="#import-r-libraries-and-load-data"></a>
</h3>
<p>First we need to import the required libraries for this analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Install SpaMTP if not previously installed</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/genomicsmachinelearning/SpaMTP" class="external-link">"SpaMTP"</a></span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"GenomicsMachineLearning/SpaMTP"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#General Libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/genomicsmachinelearning/SpaMTP" class="external-link">SpaMTP</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.cardinalmsi.org" class="external-link">Cardinal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#For plotting + DE plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kevinblighe/EnhancedVolcano" class="external-link">EnhancedVolcano</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<p>Next we will load the data, you can download or load it directly from
the <a href="https://zenodo.org/communities/spamtp/records" class="external-link"><em>SpaMTP</em>
zenodo page</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spotted_large</span> <span class="op">&lt;-</span> <span class="fu">Cardinal</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Cardinal/man/readMSIData.html" class="external-link">readImzML</a></span><span class="op">(</span><span class="st">"./Spotted/2020-12-05_ME_X190_L1_Spotted_20umss_375x450_33at_DAN_Neg"</span>,resolution <span class="op">=</span> <span class="fl">3</span>, mass.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">1000</span><span class="op">)</span>, memory <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spotted_large</span></span></code></pre></div>
<pre><code>MSImagingExperiment with 767528 features and 168750 spectra 
spectraData(1): intensity
featureData(1): mz
pixelData(3): x, y, run
coord(2): x = 1...375, y = 1...450
runNames(1): 2020-12-05_ME_X190_L1_Spotted_20umss_375x450_33at_DAN_Neg
experimentData(8): spectrumType, instrumentModel, ionSource, ..., scanPattern, scanType, lineScanDirection
mass range: 100.0000 to 999.9959 
centroided: NA </code></pre>
<p>You can see our dataset has 767,529 features and 168,750 pixels. This
is quite a large dataset that will require alot of memory to process.
However, it is likely we don’t need to analyse all the features and
pixels to generate meaningful biological conclusion.</p>
</div>
<div class="section level3">
<h3 id="annotating-large-datasets">Annotating Large Datasets<a class="anchor" aria-label="anchor" href="#annotating-large-datasets"></a>
</h3>
<p>Using the function <code>AnnotateBigData</code> we can find m/z
values that were successfully annotated and only perform the remainder
of the downstream analyses using these.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get all the m/z values from our cardinal object</span></span>
<span><span class="va">mzs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu">Cardinal</span><span class="fu">::</span><span class="fu">featureData</span><span class="op">(</span><span class="va">spotted_large</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">mz</span></span>
<span></span>
<span><span class="co">## Annotate each m/z value</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AnnotateBigData.html">AnnotateBigData</a></span><span class="op">(</span><span class="va">mzs</span>, db <span class="op">=</span> <span class="va">HMDB_db</span>, ppm_error <span class="op">=</span> <span class="fl">3</span>, adducts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M-H"</span>, <span class="st">"M+Cl"</span><span class="op">)</span>, polarity <span class="op">=</span> <span class="st">"negative"</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<pre><code>[1] 67060</code></pre>
<p>We can now see we successfully annotated 67,060 different m/z values
which will reduce our dataset size by up to ~11.5x.</p>
<p>Lets look at the annoated results:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div style="margin-left: auto;
            margin-right: auto">
<table class="table dataframe table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:center;font-weight: bold;">
observed_mz
</th>
<th style="text-align:center;font-weight: bold;">
all_IsomerNames
</th>
<th style="text-align:center;font-weight: bold;">
all_Isomers
</th>
<th style="text-align:center;font-weight: bold;">
all_Isomers_IDs
</th>
<th style="text-align:center;font-weight: bold;">
all_Adducts
</th>
<th style="text-align:center;font-weight: bold;">
all_Formulas
</th>
<th style="text-align:center;font-weight: bold;">
all_Errors
</th>
<th style="text-align:center;font-weight: bold;">
mz_names
</th>
<th style="text-align:center;font-weight: bold;">
present
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
100.0039
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
2,4-Oxazolidinedione; hydroxyoxazolone
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
HMDB0245467; HMDB0253283
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
hmdb:HMDB0245467; hmdb:HMDB0253283
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
M-H
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
C3H3NO3
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
1.1688
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
mz-100.003900076051
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
100.0042
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
2,4-Oxazolidinedione; hydroxyoxazolone
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
HMDB0245467; HMDB0253283
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
hmdb:HMDB0245467; hmdb:HMDB0253283
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
M-H
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
C3H3NO3
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
1.8312
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
mz-100.004200088201
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
100.0084
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
Cyclopentadienyl
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
HMDB0250665
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
hmdb:HMDB0250665
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
M+Cl
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
C5H5
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
1.2680
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
mz-100.00840035281
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
100.0087
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
Cyclopentadienyl
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
HMDB0250665
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
hmdb:HMDB0250665
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
M+Cl
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
C5H5
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
1.7320
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
mz-100.008700378461
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
100.0171
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
(S)-methylmalonate-semialdehyde; acetoacetate
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
HMDB0304000; HMDB0304256
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
hmdb:HMDB0304000; hmdb:HMDB0304256
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
M-H
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
C4H5O3
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
0.4013
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
mz-100.017101462133
</td>
<td style="text-align:center;border-bottom: 1px solid #ddd; border-top: 1px solid #ddd;">
TRUE
</td>
</tr>
</tbody>
</table>
</div>
<p>We can then use these m/z values to subset our results and then
generate our SpaMTP Seurat object.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Subset cardinal object</span></span>
<span><span class="va">spotted_small</span> <span class="op">&lt;-</span> <span class="fu">Cardinal</span><span class="fu">::</span><span class="fu">subset</span><span class="op">(</span><span class="va">spotted_large</span>, <span class="va">mz</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">results</span><span class="op">$</span><span class="va">observed_mz</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Convert Cardinal object to SpaMTP object</span></span>
<span><span class="va">spotted_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CardinalToSeurat.html">CardinalToSeurat</a></span><span class="op">(</span><span class="va">spotted_small</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="region-of-interest-selection">Region of Interest Selection<a class="anchor" aria-label="anchor" href="#region-of-interest-selection"></a>
</h3>
<p>Now we have our filtered SpaMTP data object lets plot it.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/ImageFeaturePlot.html" class="external-link">ImageFeaturePlot</a></span><span class="op">(</span><span class="va">spotted_small</span>, features <span class="op">=</span> <span class="st">"nCount_Spatial"</span>, dark.background <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400000</span><span class="op">)</span>, na.value <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="Big_Data_files/figure-html/unnamed-chunk-10-1.png" width="504" style="display: block; margin: auto;"></p>
<p>We can see that there are alot of pixels outside the tissue section
that are clearly noise with high intensity values. We could remove these
using filtering methods, but for the purpose of demonstrating the
built-in ROI selection tool, we can also use SpaMTP to manually select
the region we wish to analyses.</p>
<p>Lets run this below and see an example of how to use this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spotted_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SelectROIs.html">SelectROIs</a></span><span class="op">(</span><span class="va">spotted_small</span><span class="op">)</span></span></code></pre></div>
<iframe src="https://agc888.shinyapps.io/SelectROI/" width="100%" height="600px">
</iframe>
<p><br></p>
<p>Here is an example of what the selection might look like:</p>
<p><img src="vignette_data_files/Spotted_Liver/SelectROI_Expample.png" width="80%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spotted_small</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
x_coord
</th>
<th style="text-align:right;">
y_coord
</th>
<th style="text-align:right;">
ROI_1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1_1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
2_1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
3_1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
4_1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
5_1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
6_1
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
7_1
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
8_1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
9_1
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
10_1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>Looking at the last 3 columns we can see our saved ROI selection
area. Lets plot it visually:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/ImageDimPlot.html" class="external-link">ImageDimPlot</a></span><span class="op">(</span><span class="va">spotted_small</span>, group.by <span class="op">=</span> <span class="st">"ROI_1"</span>, dark.background <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="Big_Data_files/figure-html/unnamed-chunk-14-1.png" width="504" style="display: block; margin: auto;"></p>
<p>Now we can simply subset our dataset:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spotted_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">spotted_small</span>, subset <span class="op">=</span> <span class="va">ROI_1</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/ImageFeaturePlot.html" class="external-link">ImageFeaturePlot</a></span><span class="op">(</span><span class="va">spotted_small</span>, features <span class="op">=</span> <span class="st">"nCount_Spatial"</span>, dark.background <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">400000</span><span class="op">)</span>, na.value <span class="op">=</span> <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">[</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="Big_Data_files/figure-html/unnamed-chunk-15-1.png" width="504" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">## Platform: aarch64-apple-darwin20</span></span>
<span><span class="co">## Running under: macOS 15.5</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: Europe/Dublin</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] kableExtra_1.4.0       knitr_1.50             viridis_0.6.5         </span></span>
<span><span class="co">##  [4] viridisLite_0.4.2      EnhancedVolcano_1.24.0 ggrepel_0.9.6         </span></span>
<span><span class="co">##  [7] ggplot2_4.0.0          dplyr_1.1.4            Seurat_5.3.0          </span></span>
<span><span class="co">## [10] SeuratObject_5.2.0     sp_2.2-0               Cardinal_3.8.3        </span></span>
<span><span class="co">## [13] S4Vectors_0.44.0       ProtGenerics_1.38.0    BiocGenerics_0.52.0   </span></span>
<span><span class="co">## [16] BiocParallel_1.40.2    SpaMTP_1.1.0          </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] RColorBrewer_1.1-3     rstudioapi_0.17.1      jsonlite_2.0.0        </span></span>
<span><span class="co">##   [4] magrittr_2.0.4         spatstat.utils_3.2-0   farver_2.1.2          </span></span>
<span><span class="co">##   [7] rmarkdown_2.29         fs_1.6.6               ragg_1.5.0            </span></span>
<span><span class="co">##  [10] vctrs_0.6.5            ROCR_1.0-11            spatstat.explore_3.5-3</span></span>
<span><span class="co">##  [13] RCurl_1.98-1.17        htmltools_0.5.8.1      sass_0.4.10           </span></span>
<span><span class="co">##  [16] sctransform_0.4.2      parallelly_1.45.1      KernSmooth_2.23-26    </span></span>
<span><span class="co">##  [19] bslib_0.9.0            htmlwidgets_1.6.4      desc_1.4.3            </span></span>
<span><span class="co">##  [22] ica_1.0-3              plyr_1.8.9             plotly_4.11.0         </span></span>
<span><span class="co">##  [25] zoo_1.8-14             cachem_1.1.0           igraph_2.1.4          </span></span>
<span><span class="co">##  [28] mime_0.13              lifecycle_1.0.4        pkgconfig_2.0.3       </span></span>
<span><span class="co">##  [31] Matrix_1.7-4           R6_2.6.1               fastmap_1.2.0         </span></span>
<span><span class="co">##  [34] fitdistrplus_1.2-4     future_1.67.0          shiny_1.11.1          </span></span>
<span><span class="co">##  [37] digest_0.6.37          patchwork_1.3.2        tensor_1.5.1          </span></span>
<span><span class="co">##  [40] RSpectra_0.16-2        irlba_2.3.5.1          textshaping_1.0.3     </span></span>
<span><span class="co">##  [43] labeling_0.4.3         progressr_0.16.0       spatstat.sparse_3.1-0 </span></span>
<span><span class="co">##  [46] httr_1.4.7             polyclip_1.10-7        abind_1.4-8           </span></span>
<span><span class="co">##  [49] compiler_4.4.1         proxy_0.4-27           withr_3.0.2           </span></span>
<span><span class="co">##  [52] S7_0.2.0               tiff_0.1-12            DBI_1.2.3             </span></span>
<span><span class="co">##  [55] fastDummies_1.7.5      MASS_7.3-65            classInt_0.4-11       </span></span>
<span><span class="co">##  [58] units_0.8-7            tools_4.4.1            lmtest_0.9-40         </span></span>
<span><span class="co">##  [61] httpuv_1.6.16          future.apply_1.20.0    goftest_1.2-3         </span></span>
<span><span class="co">##  [64] glue_1.8.0             nlme_3.1-168           EBImage_4.48.0        </span></span>
<span><span class="co">##  [67] promises_1.3.3         sf_1.0-21              grid_4.4.1            </span></span>
<span><span class="co">##  [70] Rtsne_0.17             cluster_2.1.8.1        reshape2_1.4.4        </span></span>
<span><span class="co">##  [73] generics_0.1.4         gtable_0.3.6           spatstat.data_3.1-8   </span></span>
<span><span class="co">##  [76] class_7.3-23           tidyr_1.3.1            data.table_1.17.8     </span></span>
<span><span class="co">##  [79] xml2_1.4.0             spatstat.geom_3.6-0    RcppAnnoy_0.0.22      </span></span>
<span><span class="co">##  [82] RANN_2.6.2             pillar_1.11.1          stringr_1.5.2         </span></span>
<span><span class="co">##  [85] spam_2.11-1            RcppHNSW_0.6.0         limma_3.62.2          </span></span>
<span><span class="co">##  [88] later_1.4.4            splines_4.4.1          lattice_0.22-7        </span></span>
<span><span class="co">##  [91] survival_3.8-3         deldir_2.0-4           tidyselect_1.2.1      </span></span>
<span><span class="co">##  [94] CardinalIO_1.4.0       locfit_1.5-9.12        miniUI_0.1.2          </span></span>
<span><span class="co">##  [97] pbapply_1.7-4          gridExtra_2.3          matter_2.8.0          </span></span>
<span><span class="co">## [100] svglite_2.2.1          scattermore_1.2        xfun_0.53             </span></span>
<span><span class="co">## [103] Biobase_2.66.0         statmod_1.5.0          matrixStats_1.5.0     </span></span>
<span><span class="co">## [106] fftwtools_0.9-11       stringi_1.8.7          lazyeval_0.2.2        </span></span>
<span><span class="co">## [109] yaml_2.3.10            evaluate_1.0.5         codetools_0.2-20      </span></span>
<span><span class="co">## [112] tibble_3.3.0           cli_3.6.5              ontologyIndex_2.12    </span></span>
<span><span class="co">## [115] uwot_0.2.3             xtable_1.8-4           reticulate_1.43.0     </span></span>
<span><span class="co">## [118] systemfonts_1.2.3      jquerylib_0.1.4        Rcpp_1.1.0            </span></span>
<span><span class="co">## [121] globals_0.18.0         spatstat.random_3.4-2  zeallot_0.2.0         </span></span>
<span><span class="co">## [124] png_0.1-8              spatstat.univar_3.1-4  parallel_4.4.1        </span></span>
<span><span class="co">## [127] pkgdown_2.1.3          dotCall64_1.2          jpeg_0.1-11           </span></span>
<span><span class="co">## [130] bitops_1.0-9           listenv_0.9.1          e1071_1.7-16          </span></span>
<span><span class="co">## [133] scales_1.4.0           ggridges_0.5.7         purrr_1.1.0           </span></span>
<span><span class="co">## [136] rlang_1.1.6            cowplot_1.2.0          shinyjs_2.1.0</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/agc888" class="external-link">Andrew Causer</a>, <a href="https://github.com/BCRL-tylu" class="external-link">Tianyao Lu</a>, <a href="https://github.com/ChemCharles" class="external-link">Christopher C.J. Fitzgerald</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
